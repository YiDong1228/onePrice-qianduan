/**
 * trade-chart.js v1.0.0B1-201805051710
 * author: Billy, wmjhappy_ok@126.com
 */
!function(){var e=window,i="TradeChart";if(i in e)console.warn("Object: "+i+" exists already.");else{var t,o,r=function(e,i){if(null===e)return null;if(void 0!==e){arguments.length<2&&(i=!0);var t={};for(var o in e){var n=e[o];t[o]="object"!=typeof n||i?n:r(n,!0)}return t}},n=(t=document.createElement("canvas").getContext("2d"),o=(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1),function(){return o}),a=function(e,i){return arguments.length<2&&(i=!0),null==e||(e=String(e),i&&(e=e.trim()),0==e.length)},l=function(){};l.prototype={};var s=function(){l.apply(this,arguments)};s.prototype=Object.create(l.prototype);Object.defineProperty(s,"LinearGradient",{value:function(e){var a=[];e&&e.forEach(function(e){var i=e.split(/:/.test(e)?/\s*:\s*/:/\s*,\s*/);a.push({offset:i[0],color:i[1]})}),this.addColorStop=function(e,i){return a.push({offset:e,color:i}),this},this.getStops=function(){return a},this.apply=function(e,i,t,o,n){var r=e.createLinearGradient(i,t,o,n);return a.forEach(function(e){var i=e.offset;/%/.test(i)&&(i=parseInt(i.replace(/%/,""))/100),r.addColorStop(i,e.color)}),e.fillStyle=r,this}},configurable:!1,writable:!1});var h={setDftValue:function(e,i){for(var t in e=e||{},i=i||{})t in e||(e[t]=i[t]);return e},cloneObject:r,createSvgElement:function(e){return document.createElementNS("http://www.w3.org/2000/svg",e)},formatMoney:function(e,i){return arguments.length<2&&(i=2),1e4<=e?(e/1e4).toFixed(i).replace(/(\.[^0])0+/,"$1")+"万":1e8<=e?(e/1e8).toFixed(i).replace(/(\.[^0])0+/,"$1")+"亿":e.toFixed(i).replace(/(\.[^0])0+/,"$1")},setAttributes:function(e,i){if(null!=i)for(var t in i)e.setAttribute(t,i[t])},pixelRatio:n,isEmptyString:a,parseAsNumber:function(e,i){return a(e,!0)||!/^\d*(?:\.\d+)?$/.test(e)&&!/^\d+\.\d*$/.test(e)?1<arguments.length?Number(i):e:Number(e)}};!function(e){"use strict";var i,n=20,r=1,a=-7,l=21,s={},h=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function u(e,i,t){var o=e.constructor,n=i-(e=new o(e)).e,r=e.c;for(r.length>++i&&b(e,n,o.RM),r[0]?t?n=i:(r=e.c,n=e.e+n+1):++n;r.length<n;r.push(0));return n=e.e,1===t||t&&(i<=n||n<=o.E_NEG)?(e.s<0&&r[0]?"-":"")+(1<r.length?r[0]+"."+r.join("").slice(1):r[0])+(n<0?"e":"e+")+n:e.toString()}function b(e,i,t,o){var n=e.c,r=e.e+i+1;if(1===t?o=5<=n[r]:2===t?o=5<n[r]||5==n[r]&&(o||r<0||void 0!==n[r+1]||1&n[r-1]):3===t?o=o||void 0!==n[r]||r<0:(o=!1,0!==t&&w("!Big.RM!")),r<1||!n[0])o?(e.e=-i,e.c=[1]):e.c=[e.e=0];else{if(n.length=r--,o)for(;9<++n[r];)n[r]=0,r--||(++e.e,n.unshift(1));for(r=n.length;!n[--r];n.pop());}return e}function w(e){var i=new Error(e);throw i.name="BigError",i}s.abs=function(){var e=new this.constructor(this);return e.s=1,e},s.cmp=function(e){var i,t=this.c,o=(e=new this.constructor(e)).c,n=this.s,r=e.s,a=this.e,l=e.e;if(!t[0]||!o[0])return t[0]?n:o[0]?-r:0;if(n!=r)return n;if(i=n<0,a!=l)return l<a^i?1:-1;for(n=-1,r=(a=t.length)<(l=o.length)?a:l;++n<r;)if(t[n]!=o[n])return t[n]>o[n]^i?1:-1;return a==l?0:l<a^i?1:-1},s.div=function(e){var i=this.constructor,t=this.c,o=(e=new i(e)).c,n=this.s==e.s?1:-1,r=i.DP;if((r!==~~r||r<0||1e6<r)&&w("!Big.DP!"),!t[0]||!o[0])return t[0]==o[0]&&w(NaN),o[0]||w(n/0),new i(0*n);var a,l,s,h,u,c=o.slice(),d=a=o.length,g=t.length,f=t.slice(0,a),x=f.length,m=e,v=m.c=[],p=0,L=r+(m.e=this.e-e.e)+1;for(m.s=n,n=L<0?0:L,c.unshift(0);x++<a;f.push(0));do{for(s=0;s<10;s++){if(a!=(x=f.length))h=x<a?1:-1;else for(u=-1,h=0;++u<a;)if(o[u]!=f[u]){h=o[u]>f[u]?1:-1;break}if(!(h<0))break;for(l=x==a?o:c;x;){if(f[--x]<l[x]){for(u=x;u&&!f[--u];f[u]=9);--f[u],f[x]+=10}f[x]-=l[x]}for(;!f[0];f.shift());}v[p++]=h?s:++s,f[0]&&h?f[x]=t[d]||0:f=[t[d]]}while((d++<g||void 0!==f[0])&&n--);return v[0]||1==p||(v.shift(),m.e--),L<p&&b(m,r,i.RM,void 0!==f[0]),m},s.eq=function(e){return!this.cmp(e)},s.gt=function(e){return 0<this.cmp(e)},s.gte=function(e){return-1<this.cmp(e)},s.lt=function(e){return this.cmp(e)<0},s.lte=function(e){return this.cmp(e)<1},s.sub=s.minus=function(e){var i,t,o,n,r=this,a=r.constructor,l=r.s,s=(e=new a(e)).s;if(l!=s)return e.s=-s,r.plus(e);var h=r.c.slice(),u=r.e,c=e.c,d=e.e;if(!h[0]||!c[0])return c[0]?(e.s=-s,e):new a(h[0]?r:0);if(l=u-d){for((n=l<0)?(l=-l,o=h):(d=u,o=c),o.reverse(),s=l;s--;o.push(0));o.reverse()}else for(t=((n=h.length<c.length)?h:c).length,l=s=0;s<t;s++)if(h[s]!=c[s]){n=h[s]<c[s];break}if(n&&(o=h,h=c,c=o,e.s=-e.s),0<(s=(t=c.length)-(i=h.length)))for(;s--;h[i++]=0);for(s=i;l<t;){if(h[--t]<c[t]){for(i=t;i&&!h[--i];h[i]=9);--h[i],h[t]+=10}h[t]-=c[t]}for(;0===h[--s];h.pop());for(;0===h[0];)h.shift(),--d;return h[0]||(e.s=1,h=[d=0]),e.c=h,e.e=d,e},s.mod=function(e){var i,t=this,o=t.constructor,n=t.s,r=(e=new o(e)).s;return e.c[0]||w(NaN),t.s=e.s=1,i=1==e.cmp(t),t.s=n,e.s=r,i?new o(t):(n=o.DP,r=o.RM,o.DP=o.RM=0,t=t.div(e),o.DP=n,o.RM=r,this.minus(t.times(e)))},s.add=s.plus=function(e){var i,t=this,o=t.constructor,n=t.s,r=(e=new o(e)).s;if(n!=r)return e.s=-r,t.minus(e);var a=t.e,l=t.c,s=e.e,h=e.c;if(!l[0]||!h[0])return h[0]?e:new o(l[0]?t:0*n);if(l=l.slice(),n=a-s){for(0<n?(s=a,i=h):(n=-n,i=l),i.reverse();n--;i.push(0));i.reverse()}for(l.length-h.length<0&&(i=h,h=l,l=i),n=h.length,r=0;n;)r=(l[--n]=l[n]+h[n]+r)/10|0,l[n]%=10;for(r&&(l.unshift(r),++s),n=l.length;0===l[--n];l.pop());return e.c=l,e.e=s,e},s.pow=function(e){var i=this,t=new i.constructor(1),o=t,n=e<0;for((e!==~~e||e<-1e6||1e6<e)&&w("!pow!"),e=n?-e:e;1&e&&(o=o.times(i)),e>>=1;)i=i.times(i);return n?t.div(o):o},s.round=function(e,i){var t=this,o=t.constructor;return null==e?e=0:(e!==~~e||e<0||1e6<e)&&w("!round!"),b(t=new o(t),e,null==i?o.RM:i),t},s.sqrt=function(){var e,i,t,o=this,n=o.constructor,r=o.c,a=o.s,l=o.e,s=new n("0.5");if(!r[0])return new n(o);for(a<0&&w(NaN),0===(a=Math.sqrt(o.toString()))||a===1/0?((e=r.join("")).length+l&1||(e+="0"),(i=new n(Math.sqrt(e).toString())).e=((l+1)/2|0)-(l<0||1&l)):i=new n(a.toString()),a=i.e+(n.DP+=4);t=i,i=s.times(t.plus(o.div(t))),t.c.slice(0,a).join("")!==i.c.slice(0,a).join(""););return b(i,n.DP-=4,n.RM),i},s.mul=s.times=function(e){var i,t=this.constructor,o=this.c,n=(e=new t(e)).c,r=o.length,a=n.length,l=this.e,s=e.e;if(e.s=this.s==e.s?1:-1,!o[0]||!n[0])return new t(0*e.s);for(e.e=l+s,r<a&&(i=o,o=n,n=i,s=r,r=a,a=s),i=new Array(s=r+a);s--;i[s]=0);for(l=a;l--;){for(a=0,s=r+l;l<s;)a=i[s]+n[l]*o[s-l-1]+a,i[s--]=a%10,a=a/10|0;i[s]=(i[s]+a)%10}for(a&&++e.e,i[0]||i.shift(),l=i.length;!i[--l];i.pop());return e.c=i,e},s.toString=s.valueOf=s.toJSON=function(){var e=this,i=e.constructor,t=e.e,o=e.c.join(""),n=o.length;if(t<=i.E_NEG||t>=i.E_POS)o=o.charAt(0)+(1<n?"."+o.slice(1):"")+(t<0?"e":"e+")+t;else if(t<0){for(;++t;o="0"+o);o="0."+o}else if(0<t)if(++t>n)for(t-=n;t--;o+="0");else t<n&&(o=o.slice(0,t)+"."+o.slice(t));else 1<n&&(o=o.charAt(0)+"."+o.slice(1));return e.s<0&&e.c[0]?"-"+o:o},s.toExponential=function(e){return null==e?e=this.c.length-1:(e!==~~e||e<0||1e6<e)&&w("!toExp!"),u(this,e,1)},s.toFixed=function(e){var i,t=this,o=t.constructor,n=o.E_NEG,r=o.E_POS;return o.E_NEG=-(o.E_POS=1/0),null==e?i=t.toString():e===~~e&&0<=e&&e<=1e6&&(i=u(t,t.e+e),t.s<0&&t.c[0]&&i.indexOf("-")<0&&(i="-"+i)),o.E_NEG=n,o.E_POS=r,i||w("!toFix!"),i},s.toPrecision=function(e){return null==e?this.toString():((e!==~~e||e<1||1e6<e)&&w("!toPre!"),u(this,e-1,2))},i=function t(){function o(e){var i=this;if(!(i instanceof o))return void 0===e?t():new o(e);e instanceof o?(i.s=e.s,i.e=e.e,i.c=e.c.slice()):function(e,i){var t,o,n;for(0===i&&1/i<0?i="-0":h.test(i+="")||w(NaN),e.s="-"==i.charAt(0)?(i=i.slice(1),-1):1,-1<(t=i.indexOf("."))&&(i=i.replace(".","")),0<(o=i.search(/e/i))?(t<0&&(t=o),t+=+i.slice(o+1),i=i.substring(0,o)):t<0&&(t=i.length),o=0;"0"==i.charAt(o);o++);if(o==(n=i.length))e.c=[e.e=0];else{for(;"0"==i.charAt(--n););for(e.e=t-o-1,e.c=[],t=0;o<=n;e.c[t++]=+i.charAt(o++));}}(i,e),i.constructor=o}return o.prototype=s,o.DP=n,o.RM=r,o.E_NEG=a,o.E_POS=l,o}(),"function"==typeof define&&define.amd?define(function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:e.Big=i}(h),Object.defineProperty(s,"util",{value:h,configurable:!1,writable:!1});var u={};Object.defineProperty(s,"chart",{value:u,configurable:!1,writable:!1}),Object.defineProperty(s,"defineChart",{value:function(e,i){if(e in u)throw new Error("Chart of name: "+e+" exists already.");u[e]=i},configurable:!1,writable:!1}),e[i]=s}}(),function(){var O=window.TradeChart,G=O.util,W=G.Big,E=function(e){return Number(e.toString())},X=function(e){return Math.round(E(e))},R=function(e){return Math.floor(E(e))},B=function(e){return Math.ceil(E(e))},a={width:"100%",height:300,paddingTop:20,paddingBottom:20,paddingLeft:60,paddingRight:20,dotGap:5,axisTickLineLength:6,axisLabelFont:"normal 10px sans-serif, serif",axisLabelColor:null,axisLineColor:null,showAxisXLine:!0,showAxisXLabel:!0,axisXTickOffset:5,axisXTickOffsetFromRight:0,axisXLabelPosition:"the-very-bottom",axisXLabelOffset:5,axisXLabelSize:55,axisXLabelGenerator:function(e,i,t,o){return e.time},axisXLabelHorizontalAlign:function(e,i){return"center"},showAxisYLine:!0,showAxisYLabel:!0,axisYPosition:"left",axisYLabelPosition:"outside",axisYLabelFont:null,axisYLabelColor:null,axisYLabelOffset:5,axisYLabelVerticalOffset:function(e,i){return 0},axisYTickOffset:0,axisYMidTickQuota:3,axisYPrecision:2,axisYFormatter:function(e,i){return G.formatMoney(e,i.axisYPrecision)},axisYPriceFloor:function(e,i,t,o){return isFinite(e)||(e=0),isFinite(t)||(t=0),e=Math.max(e,0),t=Math.abs(t),E(new W(e).minus(new W(t).div(2)))},axisYPriceFloorLabelFont:null,axisYPriceFloorLabelColor:null,axisYPriceCeiling:function(e,i,t,o){return isFinite(i)||(i=0),isFinite(t)||(t=0),i=Math.max(i,0),t=Math.abs(t),E(new W(i).plus(new W(t).div(2)))},axisYPriceCeilingLabelFont:null,axisYPriceCeilingLabelColor:null,gridLineDash:[1,3,3],showHorizontalGridLine:!0,horizontalGridLineColor:"#A0A0A0",showVerticalGridLine:!0,verticalGridLineColor:"#A0A0A0",lineWidth:1,lineColor:null,coordinateBackground:null,enclosedAreaBackground:null,showVolume:!1,volumeWidth:3,volumeAreaRatio:.33,volumeMarginTop:15,volumeAxisYTickOffset:0,volumeAxisYMidTickQuota:2,volumeAxisYFloor:null,volumeAxisYLabelFont:null,volumeAxisYLabelColor:null,volumeAxisYLabelVerticalOffset:function(e,i){return 0},volumeColor:"orange",appreciatedVolumeColor:"orange",depreciatedVolumeColor:"orange",showAvgPriceLine:!1,avgPriceLineWidth:1,avgPriceLineColor:"orange",lastClosingPrice:null,showLastClosingPriceLine:!1,showLastClosingPriceLine_lineWidth:1,showLastClosingPriceLine_lineColor:null,showLastClosingPriceLine_lineDash:[1,3,3],timeSections:[]},t=function(e){return Math.floor(e.width-e.paddingLeft-e.paddingRight)},s=function(e){var i=t(e);return Math.floor(i-e.axisXTickOffset-e.axisXTickOffsetFromRight)},H=function(e){e.width,e.height;var i={width:0,contentWidth:0,height:0,contentHeight:0,volumeHeight:0,volumeContentHeight:0,maxDotCount:0,priceHeightRatio:0,volumeHeightRatio:0};String(e.axisYPosition).toLowerCase();return i.width=t(e),i.contentWidth=s(e),e.showVolume?(i.height=Math.round(E(new W(e.height).mul(1-e.volumeAreaRatio))-e.paddingTop-e.volumeMarginTop),i.volumeHeight=Math.round(E(new W(e.height).mul(e.volumeAreaRatio))-e.paddingBottom),i.volumeContentHeight=Math.floor(i.volumeHeight)):i.height=Math.floor(e.height-e.paddingTop-e.paddingBottom),i.contentHeight=Math.floor(i.height-e.axisYTickOffset),i.maxDotCount=R(new W(i.contentWidth).div(e.dotGap+1))+1,i},l=function(l,s,h,e){if(!(l instanceof i))throw new Error("Invalid argument. TrendChart instance is needed.");this.getConfig=function(){return h},this.getRenderMetadata=function(){return e},this.getDotCount=function(){return Math.min(l.getDatas().length,s.chart.maxDotCount)},this.getRenderingOriginalDatas=function(){var e=l.getDatas()||[],i=Math.min(this.getDotCount(),e.length);return e.slice(0,i)},this.getDataIndex=function(e){var i=this.getDotCount(),t=Math.floor(h.paddingLeft+h.axisXTickOffset)+.5,o=t+s.chart.contentWidth;e<t?e=t:o<e&&(e=o);var n=X(new W(e-t).div(h.dotGap+1));return n<0||i<=n?-1:n},this.getOriginalData=function(e){var i=l.getDatas()||[];return e<0||e>=i.length?null:i[e]},this.getConvertedData=function(e){var i=this.getOriginalData(e);if(null==i)return i;var t=l.getDataParser();return"function"==typeof t&&(i=t(i,e,l.getDatas()||[])),i},this.getCoordinate=function(e){var i=this.getDataIndex(e);if(-1==i)return null;var t=Math.floor(h.paddingLeft+h.axisXTickOffset)+.5,o=Math.floor(h.paddingTop)+.5,n=l.getDatas()[i],r=l.getDataParser();n=r?r(n,i,l.getDatas()||[]):n;var a={x:0,y:0};return a.x=t+X(new W(i).mul(h.dotGap+1)),a.y=o+X(new W(Math.abs(s.data.extended.priceCeiling-n.price)).div(s.chart.priceHeightRatio)),a}},i=function(){var S,V;O.apply(this,arguments),this.setDatas=function(e){return S=e,this},this.getDatas=function(){return S},this.setDataParser=function(e){return V=e,this},this.getDataParser=function(){return V},this.render=function(e,C){C=G.cloneObject(C,!0),function(e,i,t){if(i.showTrendAll&&(i.dotGap="auto"),i.axisYVolumeFloor&&(i.volumeAxisYFloor=i.axisYVolumeFloor,delete i.axisYVolumeFloor),/%/.test(i.width)&&(i.width=e.parentElement.clientWidth*parseInt(i.width.replace(/%/,""))/100),/%/.test(i.height)&&(i.height=e.parentElement.clientHeight*parseInt(i.height.replace(/%/,""))/100),G.setAttributes(e,{width:i.width,height:i.height}),"auto"==String(i.dotGap).toLowerCase()){var o=s(i),n=Math.min(o,t.length),r=n<=1?o-n:(o-n)/(n-1);console.info("Auto set trend chart dot gap to "+r),i.dotGap=r}var a=2*R(new W(i.dotGap+1).div(2))+1;i.volumeWidth>a&&(console.warn("Configured volume width("+i.volumeWidth+") is too big, auto adjust to "+a),i.volumeWidth=a);var l=G.pixelRatio();1<l&&(e.style.width=i.width+"px",e.style.height=i.height+"px",e.width=l*i.width,e.height=l*i.height,e.getContext("2d").scale(l,l))}(e,C=G.setDftValue(C,a),S);var A=e.getContext("2d"),M=function(e,i,t){for(var o={origin:{max:-1/0,min:1/0,avgVariation:0,maxVariation:0,maxVolume:-1/0,minVolume:1/0,avgVolumeVariation:0,maxVolumeVariation:0},extended:{priceCeiling:0,priceFloor:0,volumeCeiling:0,volumeFloor:0}},n=H(t),r={price:0,volume:0},a=0,l=0,s=0;s<e.length&&s<n.maxDotCount;s++){var h=e[s],u=+(h=i?i(h,s,e):h).price||0,c=G.parseAsNumber(h.avgPrice,u),d=G.parseAsNumber(h.openPrice,u),g=G.parseAsNumber(h.closePrice,u);o.origin.min=Math.min(u,c,d,g,o.origin.min),o.origin.max=Math.max(u,c,d,g,o.origin.max),+h.volume>o.origin.maxVolume&&(o.origin.maxVolume=+h.volume),+h.volume<o.origin.minVolume&&(o.origin.minVolume=+h.volume);var f=Math.abs(u-+r.price),x=Math.abs(+h.volume-+r.volume);f>o.origin.maxVariation&&(o.origin.maxVariation=f),x>o.origin.maxVolumeVariation&&(o.origin.maxVolumeVariation=x),a+=f,l+=x,r=h}var m=e.length;o.origin.avgVariation=0<m?E(new W(a).div(m)):0,o.origin.avgVolumeVariation=0<m?E(new W(l).div(m)):0;var v=t.lastClosingPrice;null!=v&&(v=Number(v)),isNaN(v)&&(v=0),null!=t.axisYPriceFloor?"function"==typeof t.axisYPriceFloor?o.extended.priceFloor=t.axisYPriceFloor(o.origin.min,o.origin.max,o.origin.avgVariation,o.origin.maxVariation):o.extended.priceFloor=Number(t.axisYPriceFloor):o.extended.priceFloor=o.origin.min-E(new W(o.origin.avgVariation).div(2)),o.extended.priceFloor=Math.min(o.extended.priceFloor,v),(!isFinite(o.extended.priceFloor)||o.extended.priceFloor<0)&&(o.extended.priceFloor=0),null!=t.axisYPriceCeiling?"function"==typeof t.axisYPriceCeiling?o.extended.priceCeiling=t.axisYPriceCeiling(o.origin.min,o.origin.max,o.origin.avgVariation,o.origin.maxVariation):o.extended.priceCeiling=Number(t.axisYPriceCeiling):o.extended.priceCeiling=o.origin.max+E(new W(o.origin.avgVariation).div(2)),o.extended.priceCeiling<o.origin.max&&(o.extended.priceCeiling=o.origin.max),o.extended.priceCeiling=Math.max(o.extended.priceCeiling,v),(!isFinite(o.extended.priceCeiling)||o.extended.priceCeiling<0)&&(o.extended.priceCeiling=o.extended.priceFloor);var p=new W(o.extended.priceFloor);return p.eq(o.extended.priceCeiling)&&(o.extended.priceCeiling=p.eq(0)?1:E(p.mul(1.3))),p=new W(o.origin.avgVolumeVariation).div(2),null!=t.volumeAxisYFloor?o.extended.volumeFloor=Number(t.volumeAxisYFloor):o.extended.volumeFloor=o.origin.minVolume-E(p),(!isFinite(o.extended.volumeFloor)||o.extended.volumeFloor<0)&&(o.extended.volumeFloor=0),o.extended.volumeCeiling=o.origin.maxVolume+E(p),(!isFinite(o.extended.volumeCeiling)||o.extended.volumeCeiling<0)&&(o.extended.volumeCeiling=0),(p=new W(o.extended.volumeFloor)).eq(o.extended.volumeCeiling)&&(o.extended.volumeCeiling=p.eq(0)?1:E(p.mul(1.3))),p=new W(o.extended.priceCeiling-o.extended.priceFloor).div(Math.max(n.contentHeight,1)),n.priceHeightRatio=p.eq(0)?1:E(p),p=new W(o.extended.volumeCeiling-o.extended.volumeFloor).div(Math.max(n.volumeContentHeight,1)),n.volumeHeightRatio=p.eq(0)?1:E(p),{data:o,chart:n}}(S,V,C);console.log("Trend chart sketch",JSON.stringify(M)),console.log("Trend chart config",C);var u,c,P=Math.min(M.chart.maxDotCount,S.length),d=E(new W(M.data.extended.priceCeiling-M.data.extended.priceFloor).div(C.axisYMidTickQuota+1)),g=E(new W(d).div(M.chart.priceHeightRatio)),i=String(C.axisYPosition).toLowerCase(),f="left"==i,t=String(C.axisYLabelPosition).toLowerCase(),o="outside"==t,x=C.showVerticalGridLine&&C.verticalGridLineColor,m=C.showHorizontalGridLine&&C.horizontalGridLineColor,Y=Math.floor(C.paddingLeft)+.5,T=Y+Math.floor(M.chart.width),F=Math.floor(C.paddingTop+M.chart.height)+.5,y=F,v=f?Y:T,k=Math.floor(C.paddingTop)+.5,p=F;C.showVolume&&(u=Math.floor(F+C.volumeMarginTop)+.5,y=Math.floor(u+M.chart.volumeHeight)+.5,c=y);var D=function(e,i){return arguments.length<2&&(i=M.data.extended.priceCeiling),E(new W(Math.abs(i-e)).div(M.chart.priceHeightRatio))},L=[],b=[],w=[];!function(){A.save(),A.lineWidth=1,C.axisLineColor&&(A.strokeStyle=C.axisLineColor),function(){A.save(),C.showAxisXLine&&(A.beginPath(),A.moveTo(Y,F),A.lineTo(T,F),A.stroke(),C.showVolume&&(A.beginPath(),A.moveTo(Y,y),A.lineTo(T,y),A.stroke()));var a=function(e,i){var t=Y+C.axisXTickOffset+Math.floor(i);x&&(A.save(),A.setLineDash&&A.setLineDash(C.gridLineDash?C.gridLineDash:[1]),A.strokeStyle=C.verticalGridLineColor,A.beginPath(),A.moveTo(t,F-1),A.lineTo(t,F-1-Math.floor(M.chart.height)),C.showVolume&&(A.moveTo(t,y-1),A.lineTo(t,y-1-Math.floor(M.chart.volumeHeight))),A.stroke(),A.restore()),L.push({x:t,label:e})},e=function(e,i){if(!(e<0||P<=e)){if(arguments.length<2){var t=V?V(S[e],e,S):S[e],o=0==e?null:S[e-1],n=S[e+1];null!=o&&V&&(o=V(o,e-1,S)),null!=n&&V&&(n=V(n,e+1,S)),i=C.axisXLabelGenerator(t,e,o,n)}var r=E(new W(C.dotGap+1).mul(e));return a(i,r)}};if(Array.isArray(C.timeSections)&&0<C.timeSections.length){var n=C.timeSections.reduce(function(e,i){return e+i.minutes},0),r=[];if(C.timeSections.reduce(function(e,i,t){0==r.length?r.push({x:0,label:i.begin}):r[r.length-1].label+="/"+i.begin;var o=E(new W(i.minutes).div(n));return r.push({x:r[r.length-1].x+o*M.chart.contentWidth,label:i.end}),Math.min(e,o)},1/0)*M.chart.contentWidth>C.axisXLabelSize)r.forEach(function(e){a(e.label,e.x)});else{a(r[0].label,r[0].x);var i=r[r.length-1];a(i.label,i.x)}}else{for(var t,o=C.dotGap+1,l=E(new W(C.axisXLabelSize).div(2)),s=B(new W(C.axisXLabelSize).div(o)),h=R(new W(P).div(s)),u=new W(s),c=0;c<h;c++)e(X(u.mul(c)));if(t=X(u.mul(c)),Math.min(E(new W(P-1).mul(o)),M.chart.contentWidth)-(E(new W(t).mul(o))+l)<l)e(P-1);else{var d=P-1,g=Math.min(t,d);e(g),g!=d&&e(d)}}A.restore()}(),function(){C.showAxisYLine&&(A.beginPath(),A.moveTo(v,k),A.lineTo(v,p),A.stroke(),C.showVolume&&(A.beginPath(),A.moveTo(v,u),A.lineTo(v,c),A.stroke()));for(var e=C.axisYMidTickQuota+1,i=0;i<=e;i++){var t=M.data.extended.priceFloor+E(new W(d).mul(i)),o=E(new W(e-i).mul(g)),n=Math.round(o);m&&0<i&&(A.save(),A.setLineDash&&A.setLineDash(C.gridLineDash?C.gridLineDash:[1]),A.strokeStyle=C.horizontalGridLineColor,A.beginPath(),A.moveTo(v,k+n),A.lineTo(v+(f?1:-1)*Math.floor(M.chart.width),k+n),A.stroke(),A.restore());var r=C.axisYFormatter||G.formatMoney;b.push({y:n,label:r(t,C)})}if(C.showVolume){var a=E(new W(M.data.extended.volumeCeiling-M.data.extended.volumeFloor).div(C.volumeAxisYMidTickQuota+1)),l=C.volumeAxisYMidTickQuota+1;if(0!=M.chart.volumeHeightRatio){var s=a/M.chart.volumeHeightRatio;for(i=0;i<=l;i++){var h=M.data.extended.volumeFloor+E(new W(a).mul(i));o=E(new W(l-i).mul(s)),n=u+Math.round(o);m&&0<i&&(A.save(),A.setLineDash&&A.setLineDash(C.gridLineDash?C.gridLineDash:[1]),A.strokeStyle=C.horizontalGridLineColor,A.beginPath(),A.moveTo(v,n),A.lineTo(v+(f?1:-1)*Math.floor(M.chart.width),n),A.stroke(),A.restore()),w.push({y:n,label:Math.floor(h)})}}else w.push({y:c,label:0})}}();var e=C.coordinateBackground;null!=e&&(A.save(),A.beginPath(),A.rect(Y,k,M.chart.width,M.chart.height),C.showVolume&&A.rect(Y,u,M.chart.width,M.chart.volumeHeight),A.strokeWidth=0,e instanceof O.LinearGradient?e.apply(A,C.paddingLeft,C.paddingTop,C.paddingLeft,C.paddingTop+M.chart.height):A.fillStyle=e,A.fill(),A.restore()),A.restore()}(),function(){A.save(),C.lineWidth&&(A.lineWidth=C.lineWidth),C.lineColor&&(A.strokeStyle=C.lineColor);var e,i,t,o=C.volumeWidth||C.dotGap-C.volumeInterval,n=X(new W(o-1).div(2)),r=Y+Math.floor(C.axisXTickOffset),a=[],l=[];a.push([r,F]);for(var s=0;s<P;s++)if(t=S[s],t=V?V(t,s,S):t,e=r+R(new W(C.dotGap+1).mul(s)),i=k+Math.floor(D(t.price)),a.push([e,i]),C.showAvgPriceLine&&null!=t.avgPrice&&(i=k+Math.floor(D(t.avgPrice)),l.push([e,i])),C.showVolume){A.save();var h=null==t.openPrice||""==String(t.openPrice).trim(),u=null==t.closePrice||""==String(t.closePrice).trim(),c=!h&&!isNaN(t.openPrice=Number(t.openPrice)),d=!u&&!isNaN(t.closePrice=Number(t.closePrice)),g=!c||!d||Math.abs(+t.closePrice-+t.openPrice)<2e-7,f=!g&&t.closePrice>t.openPrice,x=(!g&&(t.closePrice,t.openPrice),C.volumeColor);x=Array.isArray(x)?x[s%x.length]:g?C.volumeColor:f?C.appreciatedVolumeColor:C.depreciatedVolumeColor,A.fillStyle=x,A.strokeWidth=0;var m=B(new W(t.volume).div(M.chart.volumeHeightRatio)),v=Math.floor(e-n),p=Math.floor(y);A.fillRect(v,p-m,o,m),A.restore()}if(0<a.length&&a.push([a[a.length-1][0],F]),a.length-2==1)A.beginPath(),A.arc(a[1][0],a[1][1],2*A.lineWidth,0,2*Math.PI),A.fillStyle=C.lineColor,A.fill();else if(1<a.length-2){A.beginPath(),A.moveTo(a[1][0],a[1][1]);for(s=2;s<a.length-1;s++)A.lineTo(a[s][0],a[s][1]);A.stroke()}var L=C.enclosedAreaBackground;if(null!=L){for(A.save(),A.beginPath(),A.moveTo(a[0][0],a[0][1]),s=1;s<a.length;s++)A.lineTo(a[s][0],a[s][1]);A.strokeWidth=0,L instanceof O.LinearGradient?L.apply(A,C.paddingLeft,C.paddingTop,C.paddingLeft,C.paddingTop+M.chart.height):A.fillStyle=L,A.fill(),A.restore()}if(C.showLastClosingPriceLine){var b=C.lastClosingPrice;if(null!=b&&!isNaN(b=Number(b))){var w=Math.floor(k+D(b))+.5;A.save(),A.setLineDash(C.showLastClosingPriceLine_lineDash||[1]),A.lineWidth=C.showLastClosingPriceLine_lineWidth,A.strokeStyle=C.showLastClosingPriceLine_lineColor,A.beginPath(),A.moveTo(Y,w),A.lineTo(T,w),A.stroke(),A.restore()}}C.showAvgPriceLine&&0<l.length&&(A.save(),A.strokeWidth=1,C.avgPriceLineWidth&&(A.lineWidth=C.avgPriceLineWidth),C.avgPriceLineColor&&(A.strokeStyle=C.avgPriceLineColor),A.beginPath(),A.moveTo(l[0][0],l[0][1]),l.forEach(function(e){A.lineTo(e[0],e[1])}),A.stroke(),A.restore()),A.restore()}(),function(){var e;A.save(),A.lineWidth=1,C.axisLineColor&&(A.strokeStyle=C.axisLineColor),C.axisLabelFont&&(A.font=C.axisLabelFont),C.axisLabelColor&&(A.fillStyle=C.axisLabelColor),A.textAlign="center",A.textBaseline="top";var i=C.axisXLabelPosition||"the-very-bottom";switch(i=String(i).trim().toLowerCase()){case"the-very-bottom":e=C.showVolume?y:F;break;case"beneath-trend-above-volume":e=F;break;default:console.warn("Unknown axis x label position: '"+i+"'"),e=C.showVolume?y:F}var n=C.axisXLabelOffset+e;C.showAxisXLine&&(n+=C.axisTickLineLength),L.forEach(function(e,i){var t=e.x;if(C.showAxisXLine&&C.showAxisXLabel&&(A.beginPath(),A.moveTo(t,F),A.lineTo(t,F+C.axisTickLineLength),C.showVolume&&(A.moveTo(t,y),A.lineTo(t,y+C.axisTickLineLength)),A.stroke()),C.showAxisXLabel){A.save();var o=C.axisXLabelHorizontalAlign;(o=o(i,L.length))&&(A.textAlign=o),A.fillText(e.label,t,n),A.restore()}}),A.restore()}(),function(){var e;A.save(),A.lineWidth=1,C.axisLineColor&&(A.strokeStyle=C.axisLineColor),C.axisLabelFont&&(A.font=C.axisLabelFont),C.axisLabelColor&&(A.fillStyle=C.axisLabelColor),C.axisYLabelFont&&(A.font=C.axisYLabelFont),C.axisYLabelColor&&(A.fillStyle=C.axisYLabelColor),A.textAlign=f?o?"end":"start":o?"start":"end",A.textBaseline="middle";var r=(e=f?o?-1:1:o?1:-1)*C.axisTickLineLength,a=e*((C.showAxisYLine?C.axisTickLineLength:0)+C.axisYLabelOffset),l=C.axisYMidTickQuota+1;b.forEach(function(e,i){var t=e.y;if(C.showAxisYLine&&C.showAxisYLabel&&(A.beginPath(),A.moveTo(v,k+t),A.lineTo(v+r,k+t),A.stroke()),C.showAxisYLabel){var o=C.axisYLabelVerticalOffset;"function"==typeof o&&(o=o(i,l+1));var n=function(){A.fillText(e.label,v+a,k+t+o)};0==i?(A.save(),C.axisYPriceFloorLabelFont&&(A.font=C.axisYPriceFloorLabelFont),C.axisYPriceFloorLabelColor&&(A.fillStyle=C.axisYPriceFloorLabelColor),n(),A.restore()):i==l?(A.save(),C.axisYPriceCeilingLabelFont&&(A.font=C.axisYPriceCeilingLabelFont),C.axisYPriceCeilingLabelColor&&(A.fillStyle=C.axisYPriceCeilingLabelColor),n(),A.restore()):n()}}),A.restore()}(),function(){var e;A.save(),A.lineWidth=1,C.axisLineColor&&(A.strokeStyle=C.axisLineColor),C.axisLabelFont&&(A.font=C.axisLabelFont),C.axisLabelColor&&(A.fillStyle=C.axisLabelColor),C.volumeAxisYLabelFont&&(A.font=C.volumeAxisYLabelFont),C.volumeAxisYLabelColor&&(A.fillStyle=C.volumeAxisYLabelColor),A.textAlign=f?o?"end":"start":o?"start":"end",A.textBaseline="middle";var n=(e=f?o?-1:1:o?1:-1)*C.axisTickLineLength,r=e*((C.showAxisYLine?C.axisTickLineLength:0)+C.axisYLabelOffset),a=C.volumeAxisYMidTickQuota+1;w.forEach(function(e,i){var t=e.y;if(C.showAxisYLine&&C.showAxisYLabel&&(A.beginPath(),A.moveTo(v,t),A.lineTo(v+n,t),A.stroke()),C.showAxisYLabel){var o=C.volumeAxisYLabelVerticalOffset;"function"==typeof o&&(o=o(i,a+1)),A.fillText(e.label,v+r,t+o)}}),A.restore()}();var n=G.pixelRatio(),r={scaleX:n,scaleY:n,cssWidth:C.width,cssHeight:C.height};return Object.freeze&&Object.freeze(r),new l(this,M,C,r)},this.renderAt=function(e,i){var t=document.createElement("canvas");return e.appendChild(t),this.render(t,i)}};i.prototype=Object.create(O.prototype),i.calcMaxDotCount=function(e,i){return i=G.cloneObject(i,!0),i=G.setDftValue(i,a),/%/.test(i.width)&&(i.width=e.parentElement.clientWidth*parseInt(i.width.replace(/%/,""))/100),/%/.test(i.height)&&(i.height=e.parentElement.clientHeight*parseInt(i.height.replace(/%/,""))/100),H(i).maxDotCount},O.defineChart("TrendChart",i)}(),function(){var G=window.TradeChart,W=G.util,E=W.Big,X=function(e){return Number(e.toString())},R=function(e){return Math.round(X(e))},B=function(e){return Math.floor(X(e))},H=function(e){return Math.ceil(X(e))},N={width:"100%",height:300,paddingTop:20,paddingBottom:20,paddingLeft:60,paddingRight:20,groupLineWidth:1,groupBarWidth:5,groupGap:3,axisTickLineLength:6,axisLabelFont:"normal 10px sans-serif, serif",axisLabelColor:null,axisLineColor:null,showAxisXLine:!0,showAxisXLabel:!0,axisXTickOffset:5,axisXTickOffsetFromRight:0,axisXLabelPosition:"the-very-bottom",axisXLabelOffset:5,axisXLabelSize:55,axisXLabelGenerator:function(e,i,t,o){return e.time},axisXLabelHorizontalAlign:function(e,i){return"center"},showAxisYLine:!0,showAxisYLabel:!0,axisYPosition:"left",axisYLabelPosition:"outside",axisYLabelFont:null,axisYLabelColor:null,axisYLabelOffset:5,axisYLabelVerticalOffset:function(e,i){return 0},axisYTickOffset:0,axisYMidTickQuota:3,axisYPrecision:2,axisYFormatter:function(e,i){return W.formatMoney(e,i.axisYPrecision)},axisYPriceFloor:function(e,i,t,o){return isFinite(e)||(e=0),isFinite(t)||(t=0),e=Math.max(e,0),t=Math.abs(t),X(new E(e).minus(new E(t).div(2)))},axisYPriceFloorLabelFont:null,axisYPriceFloorLabelColor:null,axisYPriceCeiling:function(e,i,t,o){return isFinite(i)||(i=0),isFinite(t)||(t=0),i=Math.max(i,0),t=Math.abs(t),X(new E(i).plus(new E(t).div(2)))},axisYPriceCeilingLabelFont:null,axisYPriceCeilingLabelColor:null,gridLineDash:[1,3,3],showHorizontalGridLine:!0,horizontalGridLineColor:"#A0A0A0",showVerticalGridLine:!0,verticalGridLineColor:"#A0A0A0",appreciatedColor:"red",depreciatedColor:"#21CB21",keepedColor:"white",coordinateBackground:null,showVolume:!1,volumeAreaRatio:.33,volumeMarginTop:15,volumeAxisYTickOffset:0,volumeAxisYMidTickQuota:2,volumeAxisYFloor:null,volumeAxisYLabelFont:null,volumeAxisYLabelColor:null,volumeAxisYLabelVerticalOffset:function(e,i){return 0},volumeColor:"orange",appreciatedVolumeColor:"orange",depreciatedVolumeColor:"orange",showMAArr:[5,10,20,30],MAColorArr:["orange","blue","purple","black"],MALabelX:60,MALabelY:10,MALabelSpace:10},z=function(e){e.width,e.height;var i={width:0,contentWidth:0,height:0,contentHeight:0,volumeHeight:0,volumeContentHeight:0,maxGroupCount:0,priceHeightRatio:0,volumeHeightRatio:0};String(e.axisYPosition).toLowerCase();return i.width=Math.floor(e.width-e.paddingLeft-e.paddingRight),i.contentWidth=Math.floor(i.width-e.axisXTickOffset-e.axisXTickOffsetFromRight),e.showVolume?(i.height=R(new E(e.height).mul(1-e.volumeAreaRatio).minus(e.paddingTop+e.volumeMarginTop)),i.volumeHeight=R(new E(e.height).mul(e.volumeAreaRatio).minus(e.paddingBottom)),i.volumeContentHeight=Math.floor(i.volumeHeight)):i.height=Math.floor(e.height-e.paddingTop-e.paddingBottom),i.contentHeight=Math.floor(i.height-e.axisYTickOffset),i.maxGroupCount=B(new E(i.contentWidth).minus(e.groupLineWidth).div(e.groupGap+e.groupBarWidth))+1,i},I=function(e){return B(new E(e.groupBarWidth-e.groupLineWidth).div(2).plus(new E(e.groupLineWidth-1).div(2)))},j=function(o,e,a,i){if(!(o instanceof t))throw new Error("Invalid arguemnt. KChart instance is needed.");this.getConfig=function(){return a},this.getRenderMetadata=function(){return i},this.getGroupCount=function(){return Math.min(o.getDatas().length,e.chart.maxGroupCount)};var l=function(){return Math.floor(a.paddingLeft+a.axisXTickOffset)};this.getRenderingOriginalDatas=function(){var e=o.getDatas()||[],i=Math.min(this.getGroupCount(),e.length);return e.slice(0,i)},this.getDataIndex=function(e){var i=this.getGroupCount(),t=l(),o=Math.floor(a.width-a.paddingRight);e<t?e=t:o<e&&(e=o);var n=H(new E(e-t).div(Math.floor(a.groupBarWidth+a.groupGap)))-1;return n<0||i<=n?-1:n},this.getOriginalData=function(e){var i=o.getDatas()||[];return e<0||e>=i.length?null:i[e]},this.getConvertedData=function(e){var i=this.getOriginalData(e);if(null==i)return i;var t=trendChart.getDataParser();return"function"==typeof t&&(i=t(i,e,o.getDatas()||[])),i},this.getCoordinate=function(e,i){var t=this.getDataIndex(e);if(-1==t)return null;(arguments.length<2||W.isEmptyString(i))&&(i="left"),i=String(i).trim().toLowerCase();String(a.axisYPosition).toLowerCase();var o=a.groupBarWidth+a.groupGap,n={x:0,y:-1},r=l();return n.x=r+t*o,"left"==i&&(n.x-=I(a)),n}},t=function(){var V,O;G.apply(this,arguments),this.setDatas=function(e){return V=e,this},this.getDatas=function(){return V},this.setDataParser=function(e){return O=e,this},this.getDataParser=function(){return O},this.render=function(e,f){if(f=W.cloneObject(f,!0),(f=W.setDftValue(f,N)).groupBarWidth<f.groupLineWidth+2)throw new Error("Bar width should be bigger than group line width plus 2.");!function(e,i){i.axisYVolumeFloor&&(i.volumeAxisYFloor=i.axisYVolumeFloor),/%/.test(i.width)&&(i.width=e.parentElement.clientWidth*parseInt(i.width.replace(/%/,""))/100),/%/.test(i.height)&&(i.height=e.parentElement.clientHeight*parseInt(i.height.replace(/%/,""))/100),W.setAttributes(e,{width:i.width,height:i.height});var t=W.pixelRatio();1<t&&(e.style.width=i.width+"px",e.style.height=i.height+"px",e.width=t*i.width,e.height=t*i.height,e.getContext("2d").scale(t,t))}(e,f);var x=e.getContext("2d"),u=function(e,i,t){for(var o={origin:{max:-1/0,min:1/0,avgVariation:0,maxVariation:0,maxVolume:-1/0,minVolume:1/0,avgVolumeVariation:0,maxVolumeVariation:0},extended:{priceCeiling:0,priceFloor:0,volumeCeiling:0,volumeFloor:0}},n=z(t),r={volume:0},a=0,l=0,s=0;s<e.length&&s<n.maxGroupCount;s++){var h=e[s];h=i?i(h,s,e):h;var u=Math.max(+h.openPrice,+h.highPrice,+h.lowPrice,+h.closePrice),c=Math.min(+h.openPrice,+h.highPrice,+h.lowPrice,+h.closePrice);t.showMAArr.forEach(function(e){null!=h["MA"+e]&&(u=Math.max(+h["MA"+e],u),c=Math.min(+h["MA"+e],c))}),u>o.origin.max&&(o.origin.max=u),c<o.origin.min&&(o.origin.min=c),+h.volume>o.origin.maxVolume&&(o.origin.maxVolume=+h.volume),+h.volume<o.origin.minVolume&&(o.origin.minVolume=+h.volume);var d=Math.abs(u-c),g=Math.abs(+h.volume-+r.volume);d>o.origin.maxVariation&&(o.origin.maxVariation=d),g>o.origin.maxVolumeVariation&&(o.origin.maxVolumeVariation=g),a+=d,l+=g,r.volume=h.volume}var f=e.length;o.origin.avgVariation=0<f?X(new E(a).div(f)):0,o.origin.avgVolumeVariation=0<f?X(new E(l).div(f)):0,null!=t.axisYPriceFloor?"function"==typeof t.axisYPriceFloor?o.extended.priceFloor=t.axisYPriceFloor(o.origin.min,o.origin.max,o.origin.avgVariation,o.origin.maxVariation):o.extended.priceFloor=Number(t.axisYPriceFloor):o.extended.priceFloor=o.origin.min-X(new E(o.origin.avgVariation).div(2)),(!isFinite(o.extended.priceFloor)||o.extended.priceFloor<0)&&(o.extended.priceFloor=0),null!=t.axisYPriceCeiling?"function"==typeof t.axisYPriceCeiling?o.extended.priceCeiling=t.axisYPriceCeiling(o.origin.min,o.origin.max,o.origin.avgVariation,o.origin.maxVariation):o.extended.priceCeiling=Number(t.axisYPriceCeiling):o.extended.priceCeiling=o.origin.max+X(new E(o.origin.avgVariation).div(2)),o.extended.priceCeiling<o.origin.max&&(o.extended.priceCeiling=o.origin.max),(!isFinite(o.extended.priceCeiling)||o.extended.priceCeiling<0)&&(o.extended.priceCeiling=o.extended.priceFloor);var x=new E(o.extended.priceFloor);return x.eq(o.extended.priceCeiling)&&(o.extended.priceCeiling=x.eq(0)?1:X(x.mul(1.3))),x=new E(o.origin.avgVolumeVariation).div(2),null!=t.volumeAxisYFloor?o.extended.volumeFloor=Number(t.volumeAxisYFloor):o.extended.volumeFloor=o.origin.minVolume-X(x),(!isFinite(o.extended.volumeFloor)||o.extended.volumeFloor<0)&&(o.extended.volumeFloor=0),o.extended.volumeCeiling=o.origin.maxVolume+X(x),(!isFinite(o.extended.volumeCeiling)||o.extended.volumeCeiling<0)&&(o.extended.volumeCeiling=0),(x=new E(o.extended.volumeFloor)).eq(o.extended.volumeCeiling)&&(o.extended.volumeCeiling=x.eq(0)?1:X(x.mul(1.3))),x=new E(o.extended.priceCeiling-o.extended.priceFloor).div(Math.max(n.contentHeight,1)),n.priceHeightRatio=x.eq(0)?1:X(x),x=new E(o.extended.volumeCeiling-o.extended.volumeFloor).div(Math.max(n.volumeContentHeight,1)),n.volumeHeightRatio=x.eq(0)?1:X(x),{data:o,chart:n}}(V,O,f);console.log("K chart sketch",u),console.log("K chart config",f);var m=I(f),v=f.groupBarWidth+f.groupGap,r=Math.max(X(new E(v).div(2)),X(new E(f.axisXLabelSize).div(2))),a=Math.min(u.chart.maxGroupCount,V.length),l=H(new E(f.axisXLabelSize).div(v));l=Math.max(l,1);var c,d,s=B(new E(a).div(l)),g=X(new E(u.data.extended.priceCeiling-u.data.extended.priceFloor).div(f.axisYMidTickQuota+1)),p=X(new E(g).div(u.chart.priceHeightRatio)),i=String(f.axisYPosition).toLowerCase(),L="left"==i,t=String(f.axisYLabelPosition).toLowerCase(),o="outside"==t,h=f.showVerticalGridLine&&f.verticalGridLineColor,b=f.showHorizontalGridLine&&f.horizontalGridLineColor,w=Math.floor(f.paddingLeft)+.5,C=w+Math.floor(u.chart.width),A=Math.floor(f.paddingTop+u.chart.height)+.5,M=A,P=L?w:C,Y=Math.floor(f.paddingTop)+.5,T=A;f.showVolume&&(c=Math.floor(A+f.volumeMarginTop)+.5,M=Math.floor(c+u.chart.volumeHeight)+.5,d=M);var F=function(e,i){return arguments.length<2&&(i=u.data.extended.priceCeiling),X(new E(Math.abs(i-e)).div(u.chart.priceHeightRatio))},y=[],k=[],D=[];!function(){x.save(),x.lineWidth=1,f.axisLineColor&&(x.strokeStyle=f.axisLineColor),function(){f.showAxisXLine&&(x.beginPath(),x.moveTo(w,A),x.lineTo(C,A),f.showVolume&&(x.moveTo(w,M),x.lineTo(C,M)),x.stroke());var e,i,t=function(t){if(!(t<0||a<=t)){var o=V[t];o=O?O(o,t,V):o;var e=Math.floor(w+t*v+f.axisXTickOffset)+.5;h&&(x.save(),x.setLineDash&&x.setLineDash(f.gridLineDash?f.gridLineDash:[1]),f.verticalGridLineColor&&(x.strokeStyle=f.verticalGridLineColor),x.beginPath(),x.moveTo(e,A-1),x.lineTo(e,A-1-Math.floor(u.chart.height)),f.showVolume&&(x.moveTo(e,M),x.lineTo(e,M-Math.floor(u.chart.volumeHeight))),x.stroke(),x.restore());var i=function(){if(!f.showAxisXLabel)return"";var e=0==t?null:V[t-1],i=V[t+1];return null!=e&&O&&(e=O(e,t-1,V)),null!=i&&O&&(i=O(i,t+1,V)),f.axisXLabelGenerator(o,t,e,i)}();y.push({x:e,label:i})}};e=a-1;for(var o=new E(l),n=0;n<=s-1;n++){t(R(o.mul(n)))}i=Math.min(R(o.mul(n)),a-1),o=new E(v),Math.min(X(o.mul(a-1)),u.chart.contentWidth)-(X(o.mul(i))-m+r)<r?t(e):(t(e),i!=e&&t(i))}(),function(){f.showAxisYLine&&(x.beginPath(),x.moveTo(P,Y),x.lineTo(P,T),f.showVolume&&(x.moveTo(P,c),x.lineTo(P,d)),x.stroke());for(var e=f.axisYMidTickQuota+1,i=0;i<=e;i++){var t=u.data.extended.priceFloor+X(new E(g).mul(i)),o=X(new E(p).mul(e-i)),n=Math.round(o);b&&0<i&&(x.save(),x.setLineDash&&x.setLineDash(f.gridLineDash?f.gridLineDash:[1]),x.strokeStyle=f.horizontalGridLineColor,x.beginPath(),x.moveTo(P,Y+n),x.lineTo(P+(L?1:-1)*Math.floor(u.chart.width),Y+n),x.stroke(),x.restore());var r=f.axisYFormatter||W.formatMoney;k.push({y:n,label:r(t,f)})}if(f.showVolume){var a=X(new E(u.data.extended.volumeCeiling-u.data.extended.volumeFloor).div(f.volumeAxisYMidTickQuota+1)),l=f.volumeAxisYMidTickQuota+1;if(0!=u.chart.volumeHeightRatio){var s=X(new E(a).div(u.chart.volumeHeightRatio));for(i=0;i<=l;i++){var h=u.data.extended.volumeFloor+X(new E(a).mul(i));o=X(new E(s).mul(l-i)),n=Math.round(o);b&&0<i&&(x.save(),x.setLineDash&&x.setLineDash(f.gridLineDash?f.gridLineDash:[1]),x.strokeStyle=f.horizontalGridLineColor,x.beginPath(),x.moveTo(P,c+n),x.lineTo(P+(L?1:-1)*Math.floor(u.chart.width),c+n),x.stroke(),x.restore()),D.push({y:n,label:Math.floor(h)})}}else D.push({y:d,label:0})}}();var e=f.coordinateBackground;null!=e&&(x.save(),x.beginPath(),x.rect(w,Y,u.chart.width,u.chart.height),f.showVolume&&x.rect(w,c,u.chart.width,u.chart.volumeHeight),x.strokeWidth=0,e instanceof G.LinearGradient?e.apply(x,f.paddingLeft,f.paddingTop,f.paddingLeft,f.paddingTop+u.chart.height):x.fillStyle=e,x.fill(),x.restore()),x.restore()}(),function(){x.save();for(var e=function(e,i){var t=V[e];t=O?O(t,e,V):t;var o=Math.floor(w+f.axisXTickOffset+X(new E(v).mul(e))-m),n=t.closePrice>t.openPrice,r=(t.closePrice,t.openPrice,Math.abs(t.closePrice-t.openPrice)<2e-7);x.fillStyle=x.strokeStyle=r?f.keepedColor:n?f.appreciatedColor:f.depreciatedColor;var a=Math.max(t.highPrice,t.lowPrice),l=Math.max(t.openPrice,t.closePrice),s=o+B(new E(f.groupBarWidth-f.groupLineWidth).div(2)),h=Math.floor(Y+F(a)),u=h+Math.floor(F(t.highPrice,t.lowPrice));Math.abs(u-h)<2e-7&&(u+=1),1<f.groupLineWidth?(x.strokeWidth=0,x.fillRect(s,h,f.groupLineWidth,Math.abs(u-h))):(x.strokeWidth=1,x.beginPath(),x.moveTo(s+.5,h+.5),x.lineTo(s+.5,u+.5),x.stroke());var c=o,d=Math.floor(Y+F(l))+.5,g=Math.floor(F(t.openPrice,t.closePrice));0==g&&(g=1),x.strokeWidth=0,x.fillRect(c,d,f.groupBarWidth,g),"function"==typeof i&&i(t,e,s,c)},l=[],i=function(r,e,a,i){var t=r.closePrice>r.openPrice,o=(r.closePrice,r.openPrice,Math.abs(r.closePrice-r.openPrice)<2e-7);if(f.showMAArr.forEach(function(e,i){null==l[i]&&(l[i]=[]);var t=r["MA"+e];if(null!=t){var o=a+B(new E(f.groupLineWidth+1).div(2)),n=Math.floor(Y+F(t));l[i].push([o,n])}}),f.showVolume){x.save(),x.strokeWidth=0,x.fillStyle=t?f.appreciatedVolumeColor:o?f.volumeColor:f.depreciatedVolumeColor;var n=H(new E(r.volume).minus(u.data.extended.volumeFloor).div(u.chart.volumeHeightRatio));x.fillRect(i,Math.floor(M-n),f.groupBarWidth,n),x.restore()}},t=0;t<a;t++)e(t,i);x.textAlign=L?"start":"end",x.textBaseline="top",f.showMAArr.forEach(function(e,i){if(Array.isArray(l[i])&&0!=l[i].length){x.strokeStyle=f.MAColorArr[i],x.fillStyle=f.MAColorArr[i],x.beginPath(),x.moveTo(l[i][0][0],l[i][0][1]),l[i].forEach(function(e,i){0!=i&&x.lineTo(e[0],e[1])}),x.stroke();var t="MA"+e,o=L?f.MALabelX:C-f.MALabelX;o+=i*(x.measureText(t).width+f.MALabelSpace)*(L?1:-1),x.fillText(t,o,f.MALabelY)}}),x.restore()}(),function(){var e;x.save(),x.lineWidth=1,f.axisLineColor&&(x.strokeStyle=f.axisLineColor),f.axisLabelFont&&(x.font=f.axisLabelFont),f.axisLabelColor&&(x.fillStyle=f.axisLabelColor),x.textAlign="center",x.textBaseline="top";var i=f.axisXLabelPosition||"the-very-bottom";switch(i=String(i).trim().toLowerCase()){case"the-very-bottom":e=f.showVolume?M:A;break;case"beneath-trend-above-volume":e=A;break;default:console.warn("Unknown axis x label position: '"+i+"'"),e=f.showVolume?M:A}var n=f.axisXLabelOffset+e;f.showAxisXLine&&(n+=f.axisTickLineLength),y.forEach(function(e,i){var t=e.x;if(f.showAxisXLine&&f.showAxisXLabel&&(x.beginPath(),x.moveTo(t,A),x.lineTo(t,A+f.axisTickLineLength),f.showVolume&&(x.moveTo(t,M),x.lineTo(t,M+f.axisTickLineLength)),x.stroke()),f.showAxisXLabel){x.save();var o=f.axisXLabelHorizontalAlign;(o=o(i,y.length))&&(x.textAlign=o),x.fillText(e.label,t,n),x.restore()}}),x.restore()}(),function(){var e;x.save(),x.lineWidth=1,f.axisLineColor&&(x.strokeStyle=f.axisLineColor),f.axisLabelFont&&(x.font=f.axisLabelFont),f.axisLabelColor&&(x.fillStyle=f.axisLabelColor),f.axisYLabelFont&&(x.font=f.axisYLabelFont),f.axisYLabelColor&&(x.fillStyle=f.axisYLabelColor),x.textAlign=L?o?"end":"start":o?"start":"end",x.textBaseline="middle";var r=(e=L?o?-1:1:o?1:-1)*f.axisTickLineLength,a=e*((f.showAxisYLine?f.axisTickLineLength:0)+f.axisYLabelOffset),l=f.axisYMidTickQuota+1;k.forEach(function(e,i){var t=e.y;if(f.showAxisYLine&&f.showAxisYLabel&&(x.beginPath(),x.moveTo(P,Y+t),x.lineTo(P+r,Y+t),x.stroke()),f.showAxisYLabel){var o=f.axisYLabelVerticalOffset;"function"==typeof o&&(o=o(i,l+1));var n=function(){x.fillText(e.label,P+a,Y+t+o)};0==i?(x.save(),f.axisYPriceFloorLabelFont&&(x.font=f.axisYPriceFloorLabelFont),f.axisYPriceFloorLabelColor&&(x.fillStyle=f.axisYPriceFloorLabelColor),n(),x.restore()):i==l?(x.save(),f.axisYPriceCeilingLabelFont&&(x.font=f.axisYPriceCeilingLabelFont),f.axisYPriceCeilingLabelColor&&(x.fillStyle=f.axisYPriceCeilingLabelColor),n(),x.restore()):n()}}),x.restore()}(),function(){var e;x.save(),x.lineWidth=1,f.axisLineColor&&(x.strokeStyle=f.axisLineColor),f.axisLabelFont&&(x.font=f.axisLabelFont),f.axisLabelColor&&(x.fillStyle=f.axisLabelColor),f.volumeAxisYLabelFont&&(x.font=f.volumeAxisYLabelFont),f.volumeAxisYLabelColor&&(x.fillStyle=f.volumeAxisYLabelColor),x.textAlign=L?o?"end":"start":o?"start":"end",x.textBaseline="middle";var n=(e=L?o?-1:1:o?1:-1)*f.axisTickLineLength,r=e*((f.showAxisYLine?f.axisTickLineLength:0)+f.axisYLabelOffset),a=f.volumeAxisYMidTickQuota+1;D.forEach(function(e,i){var t=e.y;if(f.showAxisYLine&&f.showAxisYLabel&&(x.beginPath(),x.moveTo(P,c+t),x.lineTo(P+n,c+t),x.stroke()),f.showAxisYLabel){var o=f.volumeAxisYLabelVerticalOffset;"function"==typeof o&&(o=o(i,a+1)),x.fillText(e.label,P+r,c+t+o)}}),x.restore()}();var n=W.pixelRatio(),S={scaleX:n,scaleY:n,cssWidth:f.width,cssHeight:f.height};return Object.freeze&&Object.freeze(S),new j(this,u,f,S)},this.renderAt=function(e,i){var t=document.createElement("canvas");return e.appendChild(t),this.render(t,i)}};t.prototype=Object.create(G.prototype),t.calcMaxGroupCount=function(e,i){return i=W.cloneObject(i,!0),i=W.setDftValue(i,N),/%/.test(i.width)&&(i.width=e.parentElement.clientWidth*parseInt(i.width.replace(/%/,""))/100),/%/.test(i.height)&&(i.height=e.parentElement.clientHeight*parseInt(i.height.replace(/%/,""))/100),z(i).maxGroupCount},t.calcHalfGroupBarWidth=I,G.defineChart("KChart",t)}(),function(){var y=window.TradeChart,k=y.util,D=k.Big,S=function(e){return Number(e.toString())},V=function(e){return Math.round(S(e))},O=function(e){return Math.floor(S(e))},G={width:"100%",height:300,paddingTop:20,paddingBottom:20,paddingLeft:60,paddingRight:20,dotGap:5,axisTickLineLength:6,axisLabelFont:"normal 10px sans-serif, serif",axisLabelColor:null,axisLineColor:null,showAxisXLine:!0,showAxisXLabel:!0,axisXTickOffset:5,axisXTickOffsetFromRight:0,axisXLabelOffset:5,axisXLabelSize:55,axisXLabelGenerator:function(e,i,t,o){return e.price},axisXLabelHorizontalAlign:function(e,i){return"center"},showAxisYLine:!0,showAxisYLabel:!0,axisYPosition:"left",axisYLabelPosition:"outside",axisYLabelFont:null,axisYLabelColor:null,axisYLabelOffset:5,axisYLabelVerticalOffset:function(e,i){return 0},axisYTickOffset:0,axisYMidTickQuota:3,axisYPrecision:2,axisYFormatter:function(e,i){return k.formatMoney(e,i.axisYPrecision)},axisYAmountFloor:function(e,i,t,o){return isFinite(e)||(e=0),isFinite(t)||(t=0),e=Math.max(e,0),t=Math.abs(t),S(new D(e).minus(new D(t).div(2)))},axisYPriceFloorLabelFont:null,axisYPriceFloorLabelColor:null,axisYAmountCeiling:function(e,i,t,o){return isFinite(i)||(i=0),isFinite(t)||(t=0),i=Math.max(i,0),t=Math.abs(t),S(new D(i).plus(new D(t).div(2)))},axisYPriceCeilingLabelFont:null,axisYPriceCeilingLabelColor:null,gridLineDash:[1,3,3],showHorizontalGridLine:!0,horizontalGridLineColor:"#EAEAEA",showVerticalGridLine:!0,verticalGridLineColor:"#EAEAEA",coordinateBackground:null,enclosedAreaBackground4Buyer:"#79EABF",enclosedAreaBackground4Seller:"#FFE0D1",enclosedAreaGap:20,showEnclosedAreaEdgeLine:!1,enclosedAreaEdgeLineWidth:1,enclosedAreaEdgeLineColor:"#D0D0D0",enclosedAreaEdgeLineDash:[1],showAreaColorBelonging:!0,enclosedAreaBelongingTextFont:"normal 10px sans-serif, serif",enclosedAreaBelongingTextColor:null,enclosedAreaBelongingText4Buyer:"买",enclosedAreaBelongingText4Seller:"卖"},t=function(e){return Math.floor(e.width-e.paddingLeft-e.paddingRight)},W=function(e){var i=t(e);return O(new D(i-e.axisXTickOffset-e.axisXTickOffsetFromRight-e.enclosedAreaGap).div(2))},E=function(e){e.width,e.height;var i={width:0,height:0,contentWidth:0,contentHeight:0,maxDotCount:0,amountHeightRatio:0};return i.width=t(e),i.height=Math.floor(e.height-e.paddingTop-e.paddingBottom),i.contentWidth=W(e),i.contentHeight=Math.floor(i.height-e.axisYTickOffset),i.maxDotCount=O(new D(i.contentWidth).div(e.dotGap+1))+1,i},X=function(e,i,t){var o=Math.floor(e.paddingLeft+e.axisXTickOffset)+.5,n=o+Math.floor(i.chart.contentWidth-1);return 3<=arguments.length&&(n=o+Math.floor(S(new D(e.dotGap).mul(Math.max(t.length-1,0)))+t.length-1)),{min:o,max:n}},R=function(e,i,t){var o=Math.floor(e.width-1-e.paddingRight-e.axisXTickOffsetFromRight)+.5,n=o-Math.floor(i.chart.contentWidth-1);return 3<=arguments.length&&(n=o-Math.floor(S(new D(e.dotGap).mul(Math.max(t.length-1,0)))+t.length-1)),{min:n,max:o}},B=function(h,u,c,e,d){if(!(h instanceof i))throw new Error("Invalid argument. DepthChart instance is needed.");this.getConfig=function(){return c},this.getRenderMetadata=function(){return e},this.getBuyerDotCount=function(){var e=h.getDatas();return e=e&&e.buyer||[],Math.min(e.length,u.chart.maxDotCount)},this.getSellerDotCount=function(){var e=h.getDatas();return e=e&&e.seller||[],Math.min(e.length,u.chart.maxDotCount)},this.isInBuyerArea=function(e){var i=X(c,u,h.getDatas().buyer);return e>=i.min&&e<=i.max},this.isInSellerArea=function(e){var i=R(c,u,h.getDatas().seller);return e>=i.min&&e<=i.max},this.getDataPosition=function(e){var r=X(c,u,h.getDatas().buyer),a=R(c,u,h.getDatas().seller),i=this.isInBuyerArea(e),t=this.isInSellerArea(e);if(!i&&!t)return null;var o=i?"buyer":"seller",n=function(e,i){"seller"==e&&(i-=d);var t,o="buyer"==e?r:a,n={dataIndex:null,area:e};return i=Math.max(o.min,i),t=(i=Math.min(o.max,i))-o.min,n.dataIndex=V(new D(t).div(c.dotGap+1)),n}(o,e),l=h.getDatas()[o];return n.dataIndex<0||n.dataIndex>=l.length?null:n},this.getRenderingOriginalDatas=function(){var e=h.getDatas()||{},i=e.buyer||[],t=e.seller||[],o=Math.min(this.getBuyerDotCount(),i.length),n=Math.min(this.getSellerDotCount(),t.length);return{buyer:i.slice(0,o),seller:t.slice(0,n)}},this.getOriginalData=function(e,i){var t=h.getDatas()[i]||[];return e<0||e>=t.length?null:t[e]},this.getConvertedData=function(e,i){var t=this.getOriginalData(e,i);if(null==t)return t;var o=h.getDataParser();return"function"==typeof o&&(t=o(t,e)),t},this.getCoordinate=function(e){var i=this.getDataPosition(e);if(null==i)return null;var t=X(c,u,h.getDatas().buyer),o=R(c,u,h.getDatas().seller),n="buyer"==i.area?t.min:o.min,r=Math.floor(c.paddingTop)+.5,a=h.getDatas()[i.area][i.dataIndex],l=h.getDataParser();a=l?l(a,i.dataIndex):a;var s={x:0,y:0};return s.x=n+V(new D(i.dataIndex).mul(c.dotGap+1))+("seller"==i.area?d:0),s.y=r+V(new D(Math.abs(u.data.extended.amountCeiling-a.amount)).div(u.chart.amountHeightRatio)),s}},i=function(){y.apply(this,arguments);var T,F={buyer:[],seller:[]};this.setDatas=function(e){return(e=e||{}).buyer=e.buyer||[],e.seller=e.seller||[],F=e,this},this.setBuyerDatas=function(e){return e=e||[],(F=F||{buyer:[],seller:[]}).buyer=e,this},this.setSellerDatas=function(e){return e=e||[],(F=F||{buyer:[],seller:[]}).seller=e,this},this.getDatas=function(){return F},this.setDataParser=function(e){return T=e,this},this.getDataParser=function(){return T},this.render=function(e,c){c=k.cloneObject(c,!0),function(e,i,t){if(/%/.test(i.width)&&(i.width=e.parentElement.clientWidth*parseInt(i.width.replace(/%/,""))/100),/%/.test(i.height)&&(i.height=e.parentElement.clientHeight*parseInt(i.height.replace(/%/,""))/100),k.setAttributes(e,{width:i.width,height:i.height}),"auto"==String(i.dotGap).toLowerCase()){var o=W(i),n=Math.min(o,Math.max((t.buyer||[]).length,(t.seller||[]).length)),r=n<=1?o-n:S(new D(o-n).div(n-1));console.info("Auto set depth chart dot gap to "+r),i.dotGap=r}var a=k.pixelRatio();1<a&&(e.style.width=i.width+"px",e.style.height=i.height+"px",e.width=a*i.width,e.height=a*i.height,e.getContext("2d").scale(a,a))}(e,c=k.setDftValue(c,G),F);var h=e.getContext("2d"),d=function(e,i,t){var o={origin:{maxAmount:-1/0,minAmount:1/0,avgAmountVariation:0,maxAmountVariation:0},extended:{amountCeiling:0,amountFloor:0}},n=E(t),r={amount:0},a=0;e=(e.buyer||[]).concat(e.seller||[]);for(var l=0;l<e.length;l++){var s=e[l];+(s=i?i(s,l):s).amount>o.origin.maxAmount&&(o.origin.maxAmount=+s.amount),+s.amount<o.origin.minAmount&&(o.origin.minAmount=+s.amount);var h=Math.abs(+s.amount-+r.amount);h>o.origin.maxAmountVariation&&(o.origin.maxAmountVariation=h),a+=h,r=s}var u=e.length;o.origin.avgAmountVariation=0<u?S(new D(a).div(u)):0,null!=t.axisYAmountFloor?"function"==typeof t.axisYAmountFloor?o.extended.amountFloor=t.axisYAmountFloor(o.origin.minAmount,o.origin.maxAmount,o.origin.avgAmountVariation,o.origin.maxAmountVariation):o.extended.amountFloor=Number(t.axisYAmountFloor):o.extended.amountFloor=o.origin.minAmount-S(new D(o.origin.avgAmountVariation).div(2)),(!isFinite(o.extended.amountFloor)||o.extended.amountFloor<0)&&(o.extended.amountFloor=0),null!=t.axisYAmountCeiling?"function"==typeof t.axisYAmountCeiling?o.extended.amountCeiling=t.axisYAmountCeiling(o.origin.minAmount,o.origin.maxAmount,o.origin.avgAmountVariation,o.origin.maxAmountVariation):o.extended.amountCeiling=Number(t.axisYAmountCeiling):o.extended.amountCeiling=o.origin.maxAmount+S(new D(o.origin.avgAmountVariation).div(2)),o.extended.amountCeiling<o.origin.maxAmount&&(o.extended.amountCeiling=o.origin.maxAmount),(!isFinite(o.extended.amountCeiling)||o.extended.amountCeiling<0)&&(o.extended.amountCeiling=o.extended.amountFloor);var c=new D(o.extended.amountFloor);return c.eq(o.extended.amountCeiling)&&(o.extended.amountCeiling=c.eq(0)?1:S(c.mul(1.3))),c=new D(o.extended.amountCeiling-o.extended.amountFloor).div(n.contentHeight),n.amountHeightRatio=c.eq(0)?1:S(c),{data:o,chart:n}}(F,T,c);console.log("Depth chart sketch: "+JSON.stringify(d));var i,g=X(c,d,F.buyer),f=R(c,d,F.seller),x=Math.min(d.chart.maxDotCount,F.buyer.length),m=Math.min(d.chart.maxDotCount,F.seller.length),v=(i=new D(c.axisXLabelSize).div(c.dotGap+1),Math.ceil(S(i)));console.log("Depth chart buyer area x section: "+JSON.stringify(g)),console.log("Depth chart buyer area dot count: "+x),console.log("Depth chart seller area x section: "+JSON.stringify(f)),console.log("Depth chart seller area dot count: "+m),console.log("Depth chart x tick interval: "+v);var t=String(c.axisYPosition).toLowerCase(),o="left"==t,n=String(c.axisYLabelPosition).toLowerCase(),s="outside"==n,r=c.showVerticalGridLine&&c.verticalGridLineColor,u=c.showHorizontalGridLine&&c.horizontalGridLineColor,a=Math.floor(c.paddingLeft)+.5,l=a+Math.floor(d.chart.width),p=Math.floor(c.paddingTop+d.chart.height)+.5,L=o?a:l,b=Math.floor(c.paddingTop)+.5,w=p;Array.isArray(F.buyer)&&F.buyer.sort(function(e,i){return e=T?T(e):e,i=T?T(i):i,e.price>i.price?1:-1}),Array.isArray(F.seller)&&F.seller.sort(function(e,i){return e=T?T(e):e,i=T?T(i):i,e.price>i.price?1:-1});var C=[],A=[];!function(){h.save(),h.lineWidth=1,c.axisLineColor&&(h.strokeStyle=c.axisLineColor),function(){c.showAxisXLine&&(h.beginPath(),h.moveTo(a,p),h.lineTo(l,p),h.stroke());var u=function(t,o){if(!(t<0||("buyer"==o?x:m)<=t)){var n=T?T(F[o][t],t,F[o]):F[o][t],e=("buyer"==o?g.min:f.min)+V(new D(c.dotGap+1).mul(t));r&&(h.save(),h.setLineDash&&h.setLineDash(c.gridLineDash?c.gridLineDash:[1]),h.strokeStyle=c.verticalGridLineColor,h.beginPath(),h.moveTo(e,p),h.lineTo(e,p-Math.floor(d.chart.height)),h.stroke(),h.restore());var i=function(){if(!c.showAxisXLabel)return"";var e=0==t?null:F[o][t-1],i=F[o][t+1];return null!=e&&T&&(e=T(e,t-1,F[o])),null!=i&&T&&(i=T(i,t+1,F[o])),c.axisXLabelGenerator(n,t,e,i)}();C.push({x:e,label:i})}},e=function(e){for(var i=c.dotGap+1,t=S(new D(c.axisXLabelSize).div(2)),o=Math.min(d.chart.maxDotCount,F[e].length),n=0,r=O(new D(o).div(v)),a=new D(v);n<r;n++)u(S(a.mul(n)),e);var l=V(a.mul(n));if(Math.min(S(new D(o-1).mul(c.dotGap+1)),d.chart.contentWidth)-(S(new D(l).mul(i))+t)<t)u(o-1,e);else{var s=o-1,h=Math.min(l,s);u(h,e),h!=s&&u(s,e)}};e("buyer"),e("seller")}(),function(){c.showAxisYLine&&(h.beginPath(),h.moveTo(L,b),h.lineTo(L,w),h.stroke());for(var e=S(new D(d.data.extended.amountCeiling-d.data.extended.amountFloor).div(c.axisYMidTickQuota+1)),i=new D(e),t=S(i.div(d.chart.amountHeightRatio)),o=c.axisYMidTickQuota+1,n=0;n<=o;n++){var r=d.data.extended.amountFloor+S(i.mul(n)),a=S(new D(o-n).mul(t)),l=b+Math.round(a);u&&0<n&&(h.save(),h.setLineDash&&h.setLineDash(c.gridLineDash?c.gridLineDash:[1]),h.strokeStyle=c.horizontalGridLineColor,h.beginPath(),h.moveTo(L,l),h.lineTo(L+Math.floor(d.chart.width),l),h.stroke(),h.restore());var s=c.axisYFormatter||k.formatMoney;A.push({y:l,label:s(r,c)})}}();var e=c.coordinateBackground;null!=e&&(h.save(),h.beginPath(),h.rect(Math.floor(c.paddingLeft)+.5,Math.floor(c.paddingTop)+.5,d.chart.width,d.chart.height),h.strokeWidth=0,e instanceof y.LinearGradient?e.apply(h,c.paddingLeft,c.paddingTop,c.paddingLeft,c.paddingTop+d.chart.height):h.fillStyle=e,h.fill(),h.restore()),h.restore()}();var M=0;!function(){var e=function(e){for(var i,t,o=[],n=0,r="buyer"==e?x:m,a="buyer"==e?g.min:f.min;n<r;n++){var l=F[e][n];l=T?T(l,n):l;var s=d.data.extended.amountCeiling-l.amount,h=S(new D(s).div(d.chart.amountHeightRatio));i=a+V(new D(c.dotGap+1).mul(n)),t=b+Math.floor(h),o.push([i,t])}return o},r=[];0<(r=r.concat(e("buyer"))).length&&(r.unshift([g.min,p]),r.push([r[r.length-1][0],p]));var a=[];0<(a=a.concat(e("seller"))).length&&(a.unshift([f.min,p]),a.push([a[a.length-1][0],p]),0<(M=Math.floor(f.max-a[a.length-1][0]))&&a.forEach(function(e){e[0]+=M}));var i=function(e){var i="buyer"==e?r:a,t=c["buyer"==e?"enclosedAreaBackground4Buyer":"enclosedAreaBackground4Seller"];if(!(null==i||i.length<4)){h.save(),h.beginPath(),h.moveTo(i[0][0],i[0][1]);for(var o=1;o<i.length;o++)h.lineTo(i[o][0],i[o][1]);h.strokeWidth=0;var n=t;n instanceof y.LinearGradient?n.apply(h,c.paddingLeft,c.paddingTop,c.paddingLeft,c.paddingTop+d.chart.height):h.fillStyle=n,h.fill(),h.restore()}};i("buyer"),i("seller")}(),function(){if(c.showEnclosedAreaEdgeLine&&(h.save(),c.enclosedAreaEdgeLineWidth&&(h.lineWidth=c.enclosedAreaEdgeLineWidth),c.enclosedAreaEdgeLineColor&&(h.strokeStyle=c.enclosedAreaEdgeLineColor),c.enclosedAreaEdgeLineDash&&h.setLineDash&&h.setLineDash(c.enclosedAreaEdgeLineDash),h.beginPath(),h.moveTo(g.max,p-1),h.lineTo(g.max,b),h.stroke(),h.moveTo(f.min,p-1),h.lineTo(f.min,b),h.stroke(),h.restore()),c.showAreaColorBelonging){h.save(),h.textBaseline="top",c.enclosedAreaBelongingTextFont&&(h.font=c.enclosedAreaBelongingTextFont),c.enclosedAreaBelongingTextColor&&(h.fillStyle=c.enclosedAreaBelongingTextColor);var e=c.enclosedAreaBelongingText4Buyer;if(null!=e&&""!=(e=String(e).trim())){h.beginPath();var i=S(new D(g.min+g.max).div(2));h.fillText(e,i,c.paddingTop+20),h.stroke()}var t=c.enclosedAreaBelongingText4Seller;if(null!=t&&""!=(t=String(t).trim())){h.beginPath();i=S(new D(f.min+f.max).div(2));h.fillText(t,i,c.paddingTop+20),h.stroke()}h.restore()}}(),function(){h.save(),h.lineWidth=1,c.axisLineColor&&(h.strokeStyle=c.axisLineColor),c.axisLabelFont&&(h.font=c.axisLabelFont),c.axisLabelColor&&(h.fillStyle=c.axisLabelColor),h.textAlign="center",h.textBaseline="top";var n=p+c.axisXLabelOffset;c.showAxisXLine&&(n+=c.axisTickLineLength),C.forEach(function(e,i){var t=e.x;if(c.showAxisXLine&&c.showAxisXLabel&&(h.beginPath(),h.moveTo(t,p),h.lineTo(t,p+c.axisTickLineLength),h.stroke()),c.showAxisXLabel){h.save();var o=c.axisXLabelHorizontalAlign;(o=o(i,C.length))&&(h.textAlign=o),h.fillText(e.label,t,n),h.restore()}}),h.restore()}(),function(){var e;h.save(),h.lineWidth=1,c.axisLineColor&&(h.strokeStyle=c.axisLineColor),c.axisLabelFont&&(h.font=c.axisLabelFont),c.axisLabelColor&&(h.fillStyle=c.axisLabelColor),c.axisYLabelFont&&(h.font=c.axisYLabelFont),c.axisYLabelColor&&(h.fillStyle=c.axisYLabelColor),h.textAlign=o?s?"end":"start":s?"start":"end",h.textBaseline="middle";var r=(e=o?s?-1:1:s?1:-1)*c.axisTickLineLength,a=e*((c.showAxisYLine?c.axisTickLineLength:0)+c.axisYLabelOffset),l=c.axisYMidTickQuota+1;A.forEach(function(e,i){var t=e.y;if(c.showAxisYLine&&c.showAxisYLabel&&(h.beginPath(),h.moveTo(L,t),h.lineTo(L+r,t),h.stroke()),c.showAxisYLabel){var o=c.axisYLabelVerticalOffset;"function"==typeof o&&(o=o(i,l+1));var n=function(){h.fillText(e.label,L+a,t+o)};0==i?(h.save(),c.axisYPriceFloorLabelFont&&(h.font=c.axisYPriceFloorLabelFont),c.axisYPriceFloorLabelColor&&(h.fillStyle=c.axisYPriceFloorLabelColor),n(),h.restore()):i==l?(h.save(),c.axisYPriceCeilingLabelFont&&(h.font=c.axisYPriceCeilingLabelFont),c.axisYPriceCeilingLabelColor&&(h.fillStyle=c.axisYPriceCeilingLabelColor),n(),h.restore()):n()}}),h.restore()}();var P=k.pixelRatio(),Y={scaleX:P,scaleY:P,cssWidth:c.width,cssHeight:c.height};return Object.freeze&&Object.freeze(Y),new B(this,d,c,Y,M)},this.renderAt=function(e,i){var t=document.createElement("canvas");return e.appendChild(t),this.render(t,i)}};i.prototype=Object.create(y.prototype),i.calcMaxDotCount=function(e,i){return i=k.cloneObject(i,!0),i=k.setDftValue(i,G),/%/.test(i.width)&&(i.width=e.parentElement.clientWidth*parseInt(i.width.replace(/%/,""))/100),/%/.test(i.height)&&(i.height=e.parentElement.clientHeight*parseInt(i.height.replace(/%/,""))/100),E(i).maxDotCount},y.defineChart("DepthChart",i)}();